// testData = [
// 	{
// 		"date": "2021-09-18",
// 		"diff_perc": 2.2612948577136267,
// 		"count": 12818,
// 		"total": 13930,
// 		"perCent": 92.01722900215363
// 	},
// 	{
// 		"date": "2021-09-17",
// 		"diff_perc": 2.096783146920762,
// 		"count": 12088,
// 		"total": 13930,
// 		"perCent": 86.7767408470926
// 	},
// 	{
// 		"date": "2021-09-16",
// 		"diff_perc": 2.0545247755014544,
// 		"count": 12994,
// 		"total": 13930,
// 		"perCent": 93.28068916008615
// 	},
// 	{
// 		"date": "2021-09-15",
// 		"diff_perc": -1.4155520106982291,
// 		"count": 13078,
// 		"total": 13930,
// 		"perCent": 93.88370423546303
// 	},
// 	{
// 		"date": "2021-09-14",
// 		"diff_perc": 0.031821633162813424,
// 		"count": 13074,
// 		"total": 13930,
// 		"perCent": 93.85498923187366
// 	},
// 	{
// 		"date": "2021-09-13",
// 		"diff_perc": -1.9679580412082536,
// 		"count": 13112,
// 		"total": 13930,
// 		"perCent": 94.12778176597271
// 	},
// 	{
// 		"date": "2021-09-12",
// 		"diff_perc": -2.0554586383383646,
// 		"count": 13112,
// 		"total": 13930,
// 		"perCent": 94.12778176597271
// 	},
// 	{
// 		"date": "2021-09-11",
// 		"diff_perc": -2.0654666784082925,
// 		"count": 13110,
// 		"total": 13930,
// 		"perCent": 94.11342426417804
// 	},
// 	{
// 		"date": "2021-09-10",
// 		"diff_perc": -2.0572722935730825,
// 		"count": 13154,
// 		"total": 13930,
// 		"perCent": 94.42928930366116
// 	},
// 	{
// 		"date": "2021-09-09",
// 		"diff_perc": -2.0025577920317055,
// 		"count": 13195,
// 		"total": 13930,
// 		"perCent": 94.72361809045226
// 	},
// 	{
// 		"date": "2021-09-08",
// 		"diff_perc": -1.9034878226275183,
// 		"count": 13211,
// 		"total": 13930,
// 		"perCent": 94.83847810480977
// 	},
// 	{
// 		"date": "2021-09-07",
// 		"diff_perc": -1.904061802931279,
// 		"count": 13230,
// 		"total": 13930,
// 		"perCent": 94.9748743718593
// 	},
// 	{
// 		"date": "2021-09-06",
// 		"diff_perc": -0.817195229582625,
// 		"count": 13272,
// 		"total": 13930,
// 		"perCent": 95.27638190954774
// 	},
// 	{
// 		"date": "2021-09-05",
// 		"diff_perc": -0.8903245301708146,
// 		"count": 13274,
// 		"total": 13930,
// 		"perCent": 95.29073941134243
// 	},
// 	{
// 		"date": "2021-09-04",
// 		"diff_perc": -0.8888011686680165,
// 		"count": 13272,
// 		"total": 13930,
// 		"perCent": 95.27638190954774
// 	},
// 	{
// 		"date": "2021-09-03",
// 		"diff_perc": -0.899630829305196,
// 		"count": 13279,
// 		"total": 13930,
// 		"perCent": 95.32663316582915
// 	},
// 	{
// 		"date": "2021-09-02",
// 		"diff_perc": -0.674201824034826,
// 		"count": 13326,
// 		"total": 13930,
// 		"perCent": 95.66403445800431
// 	},
// 	{
// 		"date": "2021-09-01",
// 		"diff_perc": 1.8051025966786158,
// 		"count": 13347,
// 		"total": 13930,
// 		"perCent": 95.81478822684852
// 	},
// 	{
// 		"date": "2021-08-31",
// 		"diff_perc": 2.3658927575138122,
// 		"count": 13381,
// 		"total": 13930,
// 		"perCent": 96.05886575735822
// 	},
// 	{
// 		"date": "2021-08-30",
// 		"diff_perc": 1.2755324172706806,
// 		"count": 13407,
// 		"total": 13930,
// 		"perCent": 96.24551328068917
// 	},
// 	{
// 		"date": "2021-08-29",
// 		"diff_perc": 1.213892319743174,
// 		"count": 13409,
// 		"total": 13930,
// 		"perCent": 96.25987078248384
// 	},
// 	{
// 		"date": "2021-08-28",
// 		"diff_perc": 1.1938508019924006,
// 		"count": 13407,
// 		"total": 13930,
// 		"perCent": 96.24551328068917
// 	},
// 	{
// 		"date": "2021-08-27",
// 		"diff_perc": 1.1924798022562018,
// 		"count": 13413,
// 		"total": 13930,
// 		"perCent": 96.28858578607323
// 	},
// 	{
// 		"date": "2021-08-26",
// 		"diff_perc": 1.147419886505829,
// 		"count": 13558,
// 		"total": 13930,
// 		"perCent": 97.32950466618809
// 	},
// 	{
// 		"date": "2021-08-25",
// 		"diff_perc": 1.1962382188233827,
// 		"count": 13609,
// 		"total": 13930,
// 		"perCent": 97.69562096195263
// 	},
// 	{
// 		"date": "2021-08-24",
// 		"diff_perc": 1.2520777896876845,
// 		"count": 13554,
// 		"total": 13930,
// 		"perCent": 97.3007896625987
// 	},
// 	{
// 		"date": "2021-08-23",
// 		"diff_perc": 0.44644751728145177,
// 		"count": 13556,
// 		"total": 13930,
// 		"perCent": 97.3151471643934
// 	}
// ]


let canv=document.getElementById("dbGraphCanvas");
myGraph = new DB_Graph(canv,dbGraphCanvasData,"Daily Prices Compared to Average");

let rect, offsetX, offsetY, rectWidth, rectHeight

function reOffset(){
    rect = document.getElementById("dbGraphCanvas").getBoundingClientRect();
    rectWidth=rect.right-rect.left
    rectHeight=rect.bottom-rect.top
    offsetX=rect.left
    offsetY=rect.top   
    myGraph.drawBase()
    myGraph.drawDataToAxis()
    myGraph.drawDataToChart()
}
reOffset();
window.onscroll=function(e){ reOffset(); }
window.onresize=function(e){ reOffset(); }


let i

// var descriptor = document.getElementById('graphDescription');

function addDescriptor(data = false){
	let str
	if (!data){
		str = "Graph displays how each of the last 6 days (Comparands) compares to data retreived on: " + dbGraphCanvasData[0]['key'] + " (Main)"
		str += ".\n"
		str += "The difference is calculated by comparing mean prices of products between two days (Main and Comparand)"
		str += ".\n"
		str += "Accuracy of the calculation depends on number of matched products between the two days"
		str += "."
	}else if (data.meanComparand !== "n/a"){
		let w1 = (data.difference > 0) ? "more expensive" : "cheaper"
		str = "On " + data.key + " the prices were " + w1 + "(" + data.difference + "%)" + " than on " + dbGraphCanvasData[0]['key']
		str += ".\n"
		str += "Out of " + dbGraphCanvasData[0]['productCount'] + " products found on " + dbGraphCanvasData[0]['key'] + ", " + data.matchCount + " were also present on " + data.key
		str += ".\n"
		str += "Mean price of all matched products is " + data.meanComparand + " for Comparand (" + data.key + ") vs " + data.meanMain + " for Main (" + dbGraphCanvasData[0]['key'] + ")"
		str += "."
	}else{
		str = 'Blue circle indicates most recent product pull'
		str += ".\n"
		str += "Difference is equal to 0"
		str += ".\n"
		str += dbGraphCanvasData[0]['productCount'] + " products were found"
		str += "."
	}
	return str
}

// descriptor.innerText = addDescriptor()
var targetOffset = rectWidth/450
let str,adjustedMouseX,adjustedMouseY,pointX,pointY, currentLinePointer

document.addEventListener('mousemove', (event) => { 
    if (event.clientX > rect.left && event.clientX < rect.right && event.clientY > rect.top && event.clientY < rect.bottom){
        myGraph.drawBase()
		myGraph.drawDataToAxis()
		myGraph.drawDataToChart()
		// myGraph.drawLinePointer(currentLinePointer)
		for (i = 0;i < myGraph.dataPointsCoor.length;i++){
            adjustedMouseX = event.clientX-offsetX
            adjustedMouseY = event.clientY-offsetY
            pointX = rectWidth*myGraph.dataPointsCoor[i]['x']
            pointY = rectHeight*myGraph.dataPointsCoor[i]['y']
            if (Math.abs(adjustedMouseX-pointX) < targetOffset && Math.abs(adjustedMouseY-pointY) < targetOffset){
            // if (Math.abs((rectWidth*myGraph.dataPointsCoor[i]['x'] + offsetX) - event.clientX) < targetOffset && Math.abs((rectHeight*myGraph.dataPointsCoor[i]['y'] + offsetY) - event.clientY) < targetOffset){

				// indicator.classList.remove("hidden");
                // indicator.classList.add("visible");
				// descriptor.innerText = addDescriptor(myGraph.dataPointsCoor[i].data)
                
                // hide = false
				myGraph.statsPoint(i)
				// currentLinePointer = i
				// myGraph.drawLinePointer(currentLinePointer)
				break
            }
        }
        // if (hide){
		// 	// descriptor.innerText = addDescriptor()
		// 	// myGraph.drawBase()
		// 	// myGraph.drawDataToAxis()
		// 	// myGraph.drawDataToChart()
        //     // indicator.classList.add("hidden");
        //     // indicator.classList.remove("visible");
        // }
    
    }else{
		currentLinePointer = 0
	}
})

